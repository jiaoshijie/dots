#!/usr/bin/env python3

# TODO(jiaoshijie): Need to learn the config format each proxy protocol

import io
import base64
import json

def main():
    vmess2clash()

def vmess2clash():
    url = "vmess://ewogICJ2IjogIjIiLAogICJwcyI6ICJ2bWVzcyt3c3xLY1B6LmxvdmVAeHJheS5jb20iLAogICJhZGQiOiAiNDUuNzYuMTY4Ljk0IiwKICAicG9ydCI6IDQzODYzLAogICJpZCI6ICI1ZDA1NGFkYy00ZTc3LTRiYmEtOTYwMi00OTM4ZGQ5N2E5OTIiLAogICJhaWQiOiAwLAogICJuZXQiOiAid3MiLAogICJ0eXBlIjogIm5vbmUiLAogICJob3N0IjogIiIsCiAgInBhdGgiOiAiLzVkMDU0YWRjIiwKICAidGxzIjogIm5vbmUiCn0=".strip()
    if url[:8] != "vmess://":
        raise ValueError(f"{url[:8]} != 'vmess://'")
    vmess_dict = json.loads(base64.b64decode(url[8:]).decode('utf-8'))
    clash_dict = {
            "name": vmess_dict['ps'],
            "type": "vmess",
            "server": vmess_dict['add'],
            "port": vmess_dict['port'],
            "cipher": 
            "uuid":
            "alterID":
            "tls":
            "skip-cert-verify":
            "network":
            "ws-opts": {
                "path": 
            }
    }

payload = {
"basic_settings": """
mixed-port: 7890 # HTTP(S) å’Œ SOCKS ä»£ç†æ··åˆç«¯å£
udp: false
ipv6: true
allow-lan: false # ä¸å…è®¸å±€åŸŸç½‘è¿æ¥
bind-address: '*'
mode: rule
log-level: info
""",

"external_settings": """
external-controller: 0.0.0.0:9090
external-ui: /home/jsj/.config/mihomo/dashboard
unified-delay: true # TODO: don't know what this mean
secret: ''
""",

"cfw": """
# Clash for Windows
# Proxies module latency test settings
# TODO: Maybe don't need these cfw-* settings
cfw-latency-timeout: 8000
cfw-latency-url: 'http://YouTube.com/generate_204'
""",

"hosts": """
hosts:
    baidu.com: google.com  # Seems didn't work
""",

"dns": """
dns:
  enable: true
  listen: '127.0.0.1:1053'
  default-nameserver: [114.114.114.114, 223.5.5.5, 119.29.29.29]
  ipv6: true
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16 # fake-ip æ± è®¾ç½®
  use-hosts: true # æŸ¥è¯¢ hosts
  fake-ip-filter: ['*.lan', '*.localdomain', '*.example', '*.invalid', '*.localhost', '*.test', '*.local', '*.home.arpa', 'time.*.com', 'time.*.gov', 'time.*.edu.cn', 'time.*.apple.com', 'time1.*.com', 'time2.*.com', 'time3.*.com', 'time4.*.com', 'time5.*.com', 'time6.*.com', 'time7.*.com', 'ntp.*.com', 'ntp1.*.com', 'ntp2.*.com', 'ntp3.*.com', 'ntp4.*.com', 'ntp5.*.com', 'ntp6.*.com', 'ntp7.*.com', '*.time.edu.cn', '*.ntp.org.cn', +.pool.ntp.org, time1.cloud.tencent.com, music.163.com, '*.music.163.com', '*.126.net', musicapi.taihe.com, music.taihe.com, songsearch.kugou.com, trackercdn.kugou.com, '*.kuwo.cn', api-jooxtt.sanook.com, api.joox.com, joox.com, y.qq.com, '*.y.qq.com', streamoc.music.tc.qq.com, mobileoc.music.tc.qq.com, isure.stream.qqmusic.qq.com, dl.stream.qqmusic.qq.com, aqqmusic.tc.qq.com, amobile.music.tc.qq.com, '*.xiami.com', '*.music.migu.cn', music.migu.cn, +.msftconnecttest.com, +.msftncsi.com, msftconnecttest.com, msftncsi.com, localhost.ptlogin2.qq.com, localhost.sec.qq.com, +.srv.nintendo.net, +.stun.playstation.net, 'xbox.*.microsoft.com', xnotify.xboxlive.com, +.ipv6.microsoft.com, +.battlenet.com.cn, +.wotgame.cn, +.wggames.cn, +.wowsgame.cn, +.wargaming.net, proxy.golang.org, 'stun.*.*', 'stun.*.*.*', '+.stun.*.*', '+.stun.*.*.*', '+.stun.*.*.*.*', heartbeat.belkin.com, '*.linksys.com', '*.linksyssmartwifi.com', '*.router.asus.com', mesu.apple.com, swscan.apple.com, swquery.apple.com, swdownload.apple.com, swcdn.apple.com, swdist.apple.com, lens.l.google.com, stun.l.google.com, '*.square-enix.com', '*.finalfantasyxiv.com', '*.ffxiv.com', '*.ff14.sdo.com', ff.dorado.sdo.com, '*.mcdn.bilivideo.cn', +.media.dssott.com, +.pvp.net]
  nameserver: ['tls://223.5.5.5:853', 'tls://223.6.6.6:853', 'https://doh.pub/dns-query', 'https://dns.alidns.com/dns-query']
""",

"proxies": """
proxies:
""",

"proxy-groups": """
proxy-groups:
""",
}

# TODO: rule section

proxy_groups = [
        # TODO: è‡ªåŠ¨é€‰æ‹©
        {"name": "ğŸš€ èŠ‚ç‚¹é€‰æ‹©", "type": "select", "proxies": ["node1", "DIRECT"]},
        {"name": "ğŸŒ å›½å¤–åª’ä½“", "type": "select", "proxies": ["ğŸš€ èŠ‚ç‚¹é€‰æ‹©", "ğŸ¯ å…¨çƒç›´è¿", "node1"]},
        {"name": "ğŸ“² ç”µæŠ¥ä¿¡æ¯", "type": "select", "proxies": ["ğŸš€ èŠ‚ç‚¹é€‰æ‹©", "ğŸ¯ å…¨çƒç›´è¿", "node1"]},
        {"name": "î´„ å¾®è½¯æœåŠ¡", "type": "select", "proxies": ["ğŸ¯ å…¨çƒç›´è¿", "ğŸš€ èŠ‚ç‚¹é€‰æ‹©", "node1"]},
        {"name": "ğŸ è‹¹æœæœåŠ¡", "type": "select", "proxies": ["ğŸ¯ å…¨çƒç›´è¿", "ğŸš€ èŠ‚ç‚¹é€‰æ‹©", "node1"]},
        {"name": "ğŸ¯ å…¨çƒç›´è¿", "type": "select", "proxies": ["DIRECT", "ğŸš€ èŠ‚ç‚¹é€‰æ‹©"]},
        {"name": "ğŸ›‘ å…¨çƒæ‹¦æˆª", "type": "select", "proxies": ["REJECT", "DIRECT"]},
        {"name": "ğŸƒ åº”ç”¨å‡€åŒ–", "type": "select", "proxies": ["REJECT", "DIRECT"]},
        {"name": "ğŸŸ æ¼ç½‘ä¹‹é±¼", "type": "select", "proxies": ["ğŸš€ èŠ‚ç‚¹é€‰æ‹©", "ğŸ¯ å…¨çƒç›´è¿", "node1"]},
]

if __name__ == "__main__":
    main()
